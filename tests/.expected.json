[
  {
    "file": "tests/test_c_style_for_loop.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Expression_stmt\n             (Ast.Relational_expr\n                (Ast.Relational_val\n                   (Ast.Additive_val\n                      (Ast.Multiplicative_val\n                         (Ast.Unary_call\n                            (Ast.Decl_call (\n                               (Ast.Relational_expr\n                                  (Ast.Relational_val\n                                     (Ast.Additive_val\n                                        (Ast.Multiplicative_val\n                                           (Ast.Unary_val\n                                              (Ast.Ident \"printf\")))))),\n                               [(Ast.Positional\n                                   (Ast.Relational_expr\n                                      (Ast.Relational_val\n                                         (Ast.Additive_val\n                                            (Ast.Multiplicative_val\n                                               (Ast.Unary_val\n                                                  (Ast.String\n                                                     \"Testing C-style for loop\\n\")))))))\n                                 ]\n                               ))))))));\n           (Ast.For_stmt\n              (Ast.For_c\n                 { Ast.var = \"i\";\n                   init =\n                   (Ast.Relational_expr\n                      (Ast.Relational_val\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Int 10))))));\n                   cond =\n                   (Ast.Relational_expr\n                      (Ast.Gt (\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Ident \"i\")))),\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Int 0))))\n                         )));\n                   update =\n                   (Ast.Assignment_expr\n                      (Ast.Sub_assign (\"i\",\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Int 1))))\n                         )));\n                   body =\n                   [(Ast.Statement\n                       (Ast.Expression_stmt\n                          (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_call\n                                         (Ast.Decl_call (\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.Ident\n                                                              \"printf\")))))),\n                                            [(Ast.Positional\n                                                (Ast.Relational_expr\n                                                   (Ast.Relational_val\n                                                      (Ast.Additive_val\n                                                         (Ast.Multiplicative_val\n                                                            (Ast.Unary_val\n                                                               (Ast.String\n                                                                  \"i = %d\\n\")))))));\n                                              (Ast.Positional\n                                                 (Ast.Relational_expr\n                                                    (Ast.Relational_val\n                                                       (Ast.Additive_val\n                                                          (Ast.Multiplicative_val\n                                                             (Ast.Unary_val\n                                                                (Ast.Ident\n                                                                   \"i\")))))))\n                                              ]\n                                            )))))))))\n                     ]\n                   }))\n           ],\n         None)}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_c_style_for_loop.asm\n===== build/emit/test_c_style_for_loop.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov rdi, 26\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 84\n  mov byte [r12+1], 101\n  mov byte [r12+2], 115\n  mov byte [r12+3], 116\n  mov byte [r12+4], 105\n  mov byte [r12+5], 110\n  mov byte [r12+6], 103\n  mov byte [r12+7], 32\n  mov byte [r12+8], 67\n  mov byte [r12+9], 45\n  mov byte [r12+10], 115\n  mov byte [r12+11], 116\n  mov byte [r12+12], 121\n  mov byte [r12+13], 108\n  mov byte [r12+14], 101\n  mov byte [r12+15], 32\n  mov byte [r12+16], 102\n  mov byte [r12+17], 111\n  mov byte [r12+18], 114\n  mov byte [r12+19], 32\n  mov byte [r12+20], 108\n  mov byte [r12+21], 111\n  mov byte [r12+22], 111\n  mov byte [r12+23], 112\n  mov byte [r12+24], 10\n  mov byte [r12+25], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 10\n  mov qword [rbp - 8], rax\n__for_start_0:\n  mov rax, [rbp-8]\n  push rax\n  mov rax, 0\n  pop rbx\n  cmp rbx, rax\n  setg al\n  movzx rax, al\n  test rax, rax\n  jz __for_end_1\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 105\n  mov byte [r12+1], 32\n  mov byte [r12+2], 61\n  mov byte [r12+3], 32\n  mov byte [r12+4], 37\n  mov byte [r12+5], 100\n  mov byte [r12+6], 10\n  mov byte [r12+7], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 1\n  mov rbx, [rbp - 8]\n  sub rbx, rax\n  mov [rbp - 8], rbx\n  mov rax, rbx\n  jmp __for_start_0\n__for_end_1:\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "Testing C-style for loop\ni = 10\ni = 9\ni = 8\ni = 7\ni = 6\ni = 5\ni = 4\ni = 3\ni = 2\ni = 1",
    "code": 0
  },
  {
    "file": "tests/test_compound_assign.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"x\"; generics = []; params = [];\n               explicit_ret = None;\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_val (Ast.Int 10))))))))});\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"x before: %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.Ident \"x\")))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Assignment_expr\n                 (Ast.Sub_assign (\"x\",\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 3))))\n                    ))));\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"x after: %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.Ident \"x\")))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Assignment_expr\n                 (Ast.Add_assign (\"x\",\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 3))))\n                    ))));\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"x after: %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.Ident \"x\")))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Assignment_expr\n                 (Ast.Mul_assign (\"x\",\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 2))))\n                    ))));\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"x after: %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.Ident \"x\")))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Assignment_expr\n                 (Ast.Div_assign (\"x\",\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 10))))\n                    ))))\n           ],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_val\n                                                (Ast.Ident \"printf\")))))),\n                                 [(Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.String\n                                                       \"x after: %d\\n\")))))));\n                                   (Ast.Positional\n                                      (Ast.Relational_expr\n                                         (Ast.Relational_val\n                                            (Ast.Additive_val\n                                               (Ast.Multiplicative_val\n                                                  (Ast.Unary_val\n                                                     (Ast.Ident \"x\")))))))\n                                   ]\n                                 )))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_compound_assign.asm\n===== build/emit/test_compound_assign.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov rax, 10\n  mov [rbp-8], rax\n  mov rdi, 14\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 120\n  mov byte [r12+1], 32\n  mov byte [r12+2], 98\n  mov byte [r12+3], 101\n  mov byte [r12+4], 102\n  mov byte [r12+5], 111\n  mov byte [r12+6], 114\n  mov byte [r12+7], 101\n  mov byte [r12+8], 58\n  mov byte [r12+9], 32\n  mov byte [r12+10], 37\n  mov byte [r12+11], 100\n  mov byte [r12+12], 10\n  mov byte [r12+13], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 3\n  mov rbx, [rbp - 8]\n  sub rbx, rax\n  mov [rbp - 8], rbx\n  mov rax, rbx\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 120\n  mov byte [r12+1], 32\n  mov byte [r12+2], 97\n  mov byte [r12+3], 102\n  mov byte [r12+4], 116\n  mov byte [r12+5], 101\n  mov byte [r12+6], 114\n  mov byte [r12+7], 58\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 3\n  mov rbx, [rbp - 8]\n  add rax, rbx\n  mov [rbp - 8], rax\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 120\n  mov byte [r12+1], 32\n  mov byte [r12+2], 97\n  mov byte [r12+3], 102\n  mov byte [r12+4], 116\n  mov byte [r12+5], 101\n  mov byte [r12+6], 114\n  mov byte [r12+7], 58\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 2\n  mov rbx, [rbp - 8]\n  imul rax, rbx\n  mov [rbp - 8], rax\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 120\n  mov byte [r12+1], 32\n  mov byte [r12+2], 97\n  mov byte [r12+3], 102\n  mov byte [r12+4], 116\n  mov byte [r12+5], 101\n  mov byte [r12+6], 114\n  mov byte [r12+7], 58\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 10\n  mov rcx, rax\n  mov rax, [rbp - 8]\n  cqo\n  idiv rcx\n  mov [rbp - 8], rax\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 120\n  mov byte [r12+1], 32\n  mov byte [r12+2], 97\n  mov byte [r12+3], 102\n  mov byte [r12+4], 116\n  mov byte [r12+5], 101\n  mov byte [r12+6], 114\n  mov byte [r12+7], 58\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "x before: 10\nx after: 7\nx after: 10\nx after: 20\nx after: 2",
    "code": 0
  },
  {
    "file": "tests/test_enum_payload.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"Job\"; generics = [];\n        params =\n        [(Ast.Typed (\"title\", (Ast.User \"string\")));\n          (Ast.Typed (\"salary\", (Ast.User \"i32\")))];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Enum_expr (\n                  [(\"programmer\",\n                    (Some (Ast.Struct_body\n                             [(\"lang\", (Ast.User \"string\"), None)])));\n                    (\"manager\",\n                     (Some (Ast.Struct_body\n                              [(\"team_size\", (Ast.User \"i32\"), None)])));\n                    (\"intern\", (Some (Ast.Type_body Ast.Unit_typ)))],\n                  (Some [(Ast.Statement\n                            (Ast.Decl_stmt\n                               Ast.Decl {tags = []; name = \"title\";\n                                 generics = []; params = [];\n                                 explicit_ret = (Some (Ast.User \"string\"));\n                                 body =\n                                 ([],\n                                  (Some (Ast.Relational_expr\n                                           (Ast.Relational_val\n                                              (Ast.Additive_val\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_val\n                                                       (Ast.Ident \"title\"))))))))}));\n                          (Ast.Statement\n                             (Ast.Decl_stmt\n                                Ast.Decl {tags = []; name = \"salary\";\n                                  generics = []; params = [];\n                                  explicit_ret = (Some (Ast.User \"i32\"));\n                                  body =\n                                  ([],\n                                   (Some (Ast.Relational_expr\n                                            (Ast.Relational_val\n                                               (Ast.Additive_val\n                                                  (Ast.Multiplicative_val\n                                                     (Ast.Unary_val\n                                                        (Ast.Ident \"salary\"))))))))}))\n                          ])\n                  ))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"job1\"; generics = []; params = [];\n               explicit_ret = None;\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_call\n                                     (Ast.Decl_call (\n                                        (Ast.Relational_expr\n                                           (Ast.Relational_val\n                                              (Ast.Additive_val\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_member (\n                                                       (Ast.Unary_val\n                                                          (Ast.Ident \"Job\")),\n                                                       \"programmer\")))))),\n                                        [(Ast.Positional\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.String\n                                                              \"Software Engineer\")))))));\n                                          (Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.Int 120000)))))));\n                                          (Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.String\n                                                               \"Rust\")))))))\n                                          ]\n                                        )))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"job2\"; generics = []; params = [];\n                explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_call\n                                      (Ast.Decl_call (\n                                         (Ast.Relational_expr\n                                            (Ast.Relational_val\n                                               (Ast.Additive_val\n                                                  (Ast.Multiplicative_val\n                                                     (Ast.Unary_member (\n                                                        (Ast.Unary_val\n                                                           (Ast.Ident \"Job\")),\n                                                        \"manager\")))))),\n                                         [(Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.String\n                                                               \"Engineering Manager\")))))));\n                                           (Ast.Positional\n                                              (Ast.Relational_expr\n                                                 (Ast.Relational_val\n                                                    (Ast.Additive_val\n                                                       (Ast.Multiplicative_val\n                                                          (Ast.Unary_val\n                                                             (Ast.Int 150000)))))));\n                                           (Ast.Positional\n                                              (Ast.Relational_expr\n                                                 (Ast.Relational_val\n                                                    (Ast.Additive_val\n                                                       (Ast.Multiplicative_val\n                                                          (Ast.Unary_val\n                                                             (Ast.Int 10)))))))\n                                           ]\n                                         )))))))))});\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"Job 1 - Title: %s, Salary: %d, Lang: %s\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_member (\n                                                    (Ast.Unary_val\n                                                       (Ast.Ident \"job1\")),\n                                                    \"title\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_member (\n                                                    (Ast.Unary_val\n                                                       (Ast.Ident \"job1\")),\n                                                    \"salary\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_member (\n                                                    (Ast.Unary_val\n                                                       (Ast.Ident \"job1\")),\n                                                    \"lang\")))))))\n                                  ]\n                                ))))))))\n           ],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_call\n                                                (Ast.Decl_call (\n                                                   (Ast.Relational_expr\n                                                      (Ast.Relational_val\n                                                         (Ast.Additive_val\n                                                            (Ast.Multiplicative_val\n                                                               (Ast.Unary_val\n                                                                  (Ast.Ident\n                                                                    \"printf\")))))),\n                                                   [(Ast.Positional\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"Job 2 - Title: %s, Salary: %d, Team: %d\\n\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"job2\")),\n                                                                    \"title\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"job2\")),\n                                                                    \"salary\"\n                                                                    )))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"job2\")),\n                                                                    \"team_size\"\n                                                                    )))))))\n                                                     ]\n                                                   ))))))),\n                                 [])))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_enum_payload.asm\n===== build/emit/test_enum_payload.asm (generated) =====\nextern malloc\nextern printf\nglobal Job\nglobal Job_salary\nglobal Job_title\nglobal main\nsection .text\nJob_title:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  mov rax, [rax+8]\nJob_title_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nJob_salary:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  mov rax, [rax+16]\nJob_salary_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nJob:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov [rbp-16], rsi\n  mov rdi, 32\n  call malloc\n  mov r12, rax\n  mov qword [r12], 0\n  mov rax, 0\n  mov [r12+8], rax\n  mov [r12+16], rax\n  mov [r12+24], rax\n  mov rax, r12\nJob_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov rdi, 18\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 83\n  mov byte [r12+1], 111\n  mov byte [r12+2], 102\n  mov byte [r12+3], 116\n  mov byte [r12+4], 119\n  mov byte [r12+5], 97\n  mov byte [r12+6], 114\n  mov byte [r12+7], 101\n  mov byte [r12+8], 32\n  mov byte [r12+9], 69\n  mov byte [r12+10], 110\n  mov byte [r12+11], 103\n  mov byte [r12+12], 105\n  mov byte [r12+13], 110\n  mov byte [r12+14], 101\n  mov byte [r12+15], 101\n  mov byte [r12+16], 114\n  mov byte [r12+17], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 120000\n  add rsp, 8\n  push rax\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 82\n  mov byte [r12+1], 117\n  mov byte [r12+2], 115\n  mov byte [r12+3], 116\n  mov byte [r12+4], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  mov rdi, 32\n  call malloc\n  mov r12, rax\n  mov qword [r12], 0\n  push r12\n  mov rdi, 18\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 83\n  mov byte [r12+1], 111\n  mov byte [r12+2], 102\n  mov byte [r12+3], 116\n  mov byte [r12+4], 119\n  mov byte [r12+5], 97\n  mov byte [r12+6], 114\n  mov byte [r12+7], 101\n  mov byte [r12+8], 32\n  mov byte [r12+9], 69\n  mov byte [r12+10], 110\n  mov byte [r12+11], 103\n  mov byte [r12+12], 105\n  mov byte [r12+13], 110\n  mov byte [r12+14], 101\n  mov byte [r12+15], 101\n  mov byte [r12+16], 114\n  mov byte [r12+17], 0\n  mov rax, r12\n  pop r12\n  mov [r12+8], rax\n  push r12\n  mov rax, 120000\n  pop r12\n  mov [r12+16], rax\n  push r12\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 82\n  mov byte [r12+1], 117\n  mov byte [r12+2], 115\n  mov byte [r12+3], 116\n  mov byte [r12+4], 0\n  mov rax, r12\n  pop r12\n  mov [r12+24], rax\n  mov rax, r12\n  mov [rbp-8], rax\n  mov rdi, 20\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 69\n  mov byte [r12+1], 110\n  mov byte [r12+2], 103\n  mov byte [r12+3], 105\n  mov byte [r12+4], 110\n  mov byte [r12+5], 101\n  mov byte [r12+6], 101\n  mov byte [r12+7], 114\n  mov byte [r12+8], 105\n  mov byte [r12+9], 110\n  mov byte [r12+10], 103\n  mov byte [r12+11], 32\n  mov byte [r12+12], 77\n  mov byte [r12+13], 97\n  mov byte [r12+14], 110\n  mov byte [r12+15], 97\n  mov byte [r12+16], 103\n  mov byte [r12+17], 101\n  mov byte [r12+18], 114\n  mov byte [r12+19], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 150000\n  add rsp, 8\n  push rax\n  mov rax, 10\n  push rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  mov rdi, 32\n  call malloc\n  mov r12, rax\n  mov qword [r12], 1\n  push r12\n  mov rdi, 20\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 69\n  mov byte [r12+1], 110\n  mov byte [r12+2], 103\n  mov byte [r12+3], 105\n  mov byte [r12+4], 110\n  mov byte [r12+5], 101\n  mov byte [r12+6], 101\n  mov byte [r12+7], 114\n  mov byte [r12+8], 105\n  mov byte [r12+9], 110\n  mov byte [r12+10], 103\n  mov byte [r12+11], 32\n  mov byte [r12+12], 77\n  mov byte [r12+13], 97\n  mov byte [r12+14], 110\n  mov byte [r12+15], 97\n  mov byte [r12+16], 103\n  mov byte [r12+17], 101\n  mov byte [r12+18], 114\n  mov byte [r12+19], 0\n  mov rax, r12\n  pop r12\n  mov [r12+8], rax\n  push r12\n  mov rax, 150000\n  pop r12\n  mov [r12+16], rax\n  push r12\n  mov rax, 10\n  pop r12\n  mov [r12+24], rax\n  mov rax, r12\n  mov [rbp-16], rax\n  mov rdi, 41\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 74\n  mov byte [r12+1], 111\n  mov byte [r12+2], 98\n  mov byte [r12+3], 32\n  mov byte [r12+4], 49\n  mov byte [r12+5], 32\n  mov byte [r12+6], 45\n  mov byte [r12+7], 32\n  mov byte [r12+8], 84\n  mov byte [r12+9], 105\n  mov byte [r12+10], 116\n  mov byte [r12+11], 108\n  mov byte [r12+12], 101\n  mov byte [r12+13], 58\n  mov byte [r12+14], 32\n  mov byte [r12+15], 37\n  mov byte [r12+16], 115\n  mov byte [r12+17], 44\n  mov byte [r12+18], 32\n  mov byte [r12+19], 83\n  mov byte [r12+20], 97\n  mov byte [r12+21], 108\n  mov byte [r12+22], 97\n  mov byte [r12+23], 114\n  mov byte [r12+24], 121\n  mov byte [r12+25], 58\n  mov byte [r12+26], 32\n  mov byte [r12+27], 37\n  mov byte [r12+28], 100\n  mov byte [r12+29], 44\n  mov byte [r12+30], 32\n  mov byte [r12+31], 76\n  mov byte [r12+32], 97\n  mov byte [r12+33], 110\n  mov byte [r12+34], 103\n  mov byte [r12+35], 58\n  mov byte [r12+36], 32\n  mov byte [r12+37], 37\n  mov byte [r12+38], 115\n  mov byte [r12+39], 10\n  mov byte [r12+40], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  mov rax, [rax+8]\n  add rsp, 8\n  push rax\n  mov rax, [rbp-8]\n  mov rax, [rax+16]\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  mov rax, [rax+24]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rcx, rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rdi, 41\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 74\n  mov byte [r12+1], 111\n  mov byte [r12+2], 98\n  mov byte [r12+3], 32\n  mov byte [r12+4], 50\n  mov byte [r12+5], 32\n  mov byte [r12+6], 45\n  mov byte [r12+7], 32\n  mov byte [r12+8], 84\n  mov byte [r12+9], 105\n  mov byte [r12+10], 116\n  mov byte [r12+11], 108\n  mov byte [r12+12], 101\n  mov byte [r12+13], 58\n  mov byte [r12+14], 32\n  mov byte [r12+15], 37\n  mov byte [r12+16], 115\n  mov byte [r12+17], 44\n  mov byte [r12+18], 32\n  mov byte [r12+19], 83\n  mov byte [r12+20], 97\n  mov byte [r12+21], 108\n  mov byte [r12+22], 97\n  mov byte [r12+23], 114\n  mov byte [r12+24], 121\n  mov byte [r12+25], 58\n  mov byte [r12+26], 32\n  mov byte [r12+27], 37\n  mov byte [r12+28], 100\n  mov byte [r12+29], 44\n  mov byte [r12+30], 32\n  mov byte [r12+31], 84\n  mov byte [r12+32], 101\n  mov byte [r12+33], 97\n  mov byte [r12+34], 109\n  mov byte [r12+35], 58\n  mov byte [r12+36], 32\n  mov byte [r12+37], 37\n  mov byte [r12+38], 100\n  mov byte [r12+39], 10\n  mov byte [r12+40], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-16]\n  mov rax, [rax+8]\n  add rsp, 8\n  push rax\n  mov rax, [rbp-16]\n  mov rax, [rax+16]\n  push rax\n  push rax\n  mov rax, [rbp-16]\n  mov rax, [rax+24]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rcx, rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "Job 1 - Title: Software Engineer, Salary: 120000, Lang: Rust\nJob 2 - Title: Engineering Manager, Salary: 150000, Team: 10",
    "code": 0
  },
  {
    "file": "tests/test_error.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 1))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_error.asm\n===== build/emit/test_error.asm (generated) =====\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 0\n  mov rax, 1\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "",
    "code": 1
  },
  {
    "file": "tests/test_for_loop.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Expression_stmt\n             (Ast.Relational_expr\n                (Ast.Relational_val\n                   (Ast.Additive_val\n                      (Ast.Multiplicative_val\n                         (Ast.Unary_call\n                            (Ast.Decl_call (\n                               (Ast.Relational_expr\n                                  (Ast.Relational_val\n                                     (Ast.Additive_val\n                                        (Ast.Multiplicative_val\n                                           (Ast.Unary_val\n                                              (Ast.Ident \"printf\")))))),\n                               [(Ast.Positional\n                                   (Ast.Relational_expr\n                                      (Ast.Relational_val\n                                         (Ast.Additive_val\n                                            (Ast.Multiplicative_val\n                                               (Ast.Unary_val\n                                                  (Ast.String\n                                                     \"In T-minus...\\n\")))))))\n                                 ]\n                               ))))))));\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"countdown\"; generics = [];\n                params = []; explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.List_expr\n                          [(Ast.Relational_expr\n                              (Ast.Relational_val\n                                 (Ast.Additive_val\n                                    (Ast.Multiplicative_val\n                                       (Ast.Unary_val (Ast.Int 10))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 9))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 8))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 7))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 6))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 5))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 4))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 3))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 2))))));\n                            (Ast.Relational_expr\n                               (Ast.Relational_val\n                                  (Ast.Additive_val\n                                     (Ast.Multiplicative_val\n                                        (Ast.Unary_val (Ast.Int 1))))))\n                            ])))});\n           (Ast.For_stmt\n              (Ast.For_iter\n                 { Ast.var = \"tick\";\n                   iterable =\n                   (Ast.Relational_expr\n                      (Ast.Relational_val\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Ident \"countdown\"))))));\n                   body =\n                   [(Ast.Statement\n                       (Ast.Expression_stmt\n                          (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_call\n                                         (Ast.Decl_call (\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.Ident\n                                                              \"printf\")))))),\n                                            [(Ast.Positional\n                                                (Ast.Relational_expr\n                                                   (Ast.Relational_val\n                                                      (Ast.Additive_val\n                                                         (Ast.Multiplicative_val\n                                                            (Ast.Unary_val\n                                                               (Ast.String\n                                                                  \"%d...\\n\")))))));\n                                              (Ast.Positional\n                                                 (Ast.Relational_expr\n                                                    (Ast.Relational_val\n                                                       (Ast.Additive_val\n                                                          (Ast.Multiplicative_val\n                                                             (Ast.Unary_val\n                                                                (Ast.Ident\n                                                                   \"tick\")))))))\n                                              ]\n                                            )))))))))\n                     ]\n                   }));\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"my_str\"; generics = [];\n                params = []; explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_val (Ast.String \"Hello world\"))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"idx\"; generics = []; params = [];\n                explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_val (Ast.Int 0))))))))});\n           (Ast.For_stmt\n              (Ast.For_iter\n                 { Ast.var = \"c\";\n                   iterable =\n                   (Ast.Relational_expr\n                      (Ast.Relational_val\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Ident \"my_str\"))))));\n                   body =\n                   [(Ast.Statement\n                       (Ast.Expression_stmt\n                          (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_call\n                                         (Ast.Decl_call (\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.Ident\n                                                              \"printf\")))))),\n                                            [(Ast.Positional\n                                                (Ast.Relational_expr\n                                                   (Ast.Relational_val\n                                                      (Ast.Additive_val\n                                                         (Ast.Multiplicative_val\n                                                            (Ast.Unary_val\n                                                               (Ast.String\n                                                                  \"%d -> %c\\n\")))))));\n                                              (Ast.Positional\n                                                 (Ast.Relational_expr\n                                                    (Ast.Relational_val\n                                                       (Ast.Additive_val\n                                                          (Ast.Multiplicative_val\n                                                             (Ast.Unary_val\n                                                                (Ast.Ident\n                                                                   \"idx\")))))));\n                                              (Ast.Positional\n                                                 (Ast.Relational_expr\n                                                    (Ast.Relational_val\n                                                       (Ast.Additive_val\n                                                          (Ast.Multiplicative_val\n                                                             (Ast.Unary_val\n                                                                (Ast.Ident\n                                                                   \"c\")))))))\n                                              ]\n                                            )))))))));\n                     (Ast.Statement\n                        (Ast.Expression_stmt\n                           (Ast.Assignment_expr\n                              (Ast.Add_assign (\"idx\",\n                                 (Ast.Additive_val\n                                    (Ast.Multiplicative_val\n                                       (Ast.Unary_val (Ast.Int 1))))\n                                 )))))\n                     ]\n                   }))\n           ],\n         None)}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_for_loop.asm\n===== build/emit/test_for_loop.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 64\n  sub rsp, 64\n  mov rdi, 15\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 73\n  mov byte [r12+1], 110\n  mov byte [r12+2], 32\n  mov byte [r12+3], 84\n  mov byte [r12+4], 45\n  mov byte [r12+5], 109\n  mov byte [r12+6], 105\n  mov byte [r12+7], 110\n  mov byte [r12+8], 117\n  mov byte [r12+9], 115\n  mov byte [r12+10], 46\n  mov byte [r12+11], 46\n  mov byte [r12+12], 46\n  mov byte [r12+13], 10\n  mov byte [r12+14], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov r12, 0\n  mov rax, 1\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 2\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 3\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 4\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 5\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 6\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 7\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 8\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 9\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, 10\n  mov rbx, rax\n  mov rdi, 16\n  call malloc\n  mov [rax], rbx\n  mov [rax+8], r12\n  mov r12, rax\n  mov rax, r12\n  mov [rbp-8], rax\n  mov rax, [rbp-8]\n  mov [rbp - 16], rax\n__for_start_4:\n  mov r12, [rbp - 16]\n  cmp r12, 0\n  je __for_end_5\n  mov rax, [r12]\n  mov [rbp - 24], rax\n  mov r12, [r12+8]\n  mov [rbp - 16], r12\n  mov rdi, 7\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 37\n  mov byte [r12+1], 100\n  mov byte [r12+2], 46\n  mov byte [r12+3], 46\n  mov byte [r12+4], 46\n  mov byte [r12+5], 10\n  mov byte [r12+6], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-24]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  jmp __for_start_4\n__for_end_5:\n  mov rdi, 12\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 72\n  mov byte [r12+1], 101\n  mov byte [r12+2], 108\n  mov byte [r12+3], 108\n  mov byte [r12+4], 111\n  mov byte [r12+5], 32\n  mov byte [r12+6], 119\n  mov byte [r12+7], 111\n  mov byte [r12+8], 114\n  mov byte [r12+9], 108\n  mov byte [r12+10], 100\n  mov byte [r12+11], 0\n  mov rax, r12\n  mov [rbp-32], rax\n  mov rax, 0\n  mov [rbp-40], rax\n  mov rax, [rbp-32]\n  ; for-in expects an int or list\n  mov rax, 0\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "In T-minus...\n10...\n9...\n8...\n7...\n6...\n5...\n4...\n3...\n2...\n1...",
    "code": 0
  },
  {
    "file": "tests/test_generics.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"Box\"; generics = [\"T\"];\n        params = [(Ast.Typed (\"value\", (Ast.User \"T\")))];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Struct_expr (\n                  [(\"value\", (Ast.User \"T\"),\n                    (Some (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_val (Ast.Ident \"value\"))))))))\n                    ],\n                  (Some [(Ast.Statement\n                            (Ast.Decl_stmt\n                               Ast.Decl {tags = []; name = \"get\";\n                                 generics = [];\n                                 params = [(Ast.Untyped \"self\")];\n                                 explicit_ret = None;\n                                 body =\n                                 ([],\n                                  (Some (Ast.Relational_expr\n                                           (Ast.Relational_val\n                                              (Ast.Additive_val\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_member (\n                                                       (Ast.Unary_val\n                                                          (Ast.Ident \"self\")),\n                                                       \"value\"))))))))}))\n                          ])\n                  ))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"Pair\"; generics = [\"A\"; \"B\"];\n        params =\n        [(Ast.Typed (\"first\", (Ast.User \"A\")));\n          (Ast.Typed (\"second\", (Ast.User \"B\")))];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Struct_expr (\n                  [(\"first\", (Ast.User \"A\"),\n                    (Some (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_val (Ast.Ident \"first\"))))))));\n                    (\"second\", (Ast.User \"B\"),\n                     (Some (Ast.Relational_expr\n                              (Ast.Relational_val\n                                 (Ast.Additive_val\n                                    (Ast.Multiplicative_val\n                                       (Ast.Unary_val (Ast.Ident \"second\"))))))))\n                    ],\n                  None))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"int_box\"; generics = [];\n               params = [];\n               explicit_ret =\n               (Some (Ast.Generic (\"Box\", [(Ast.User \"i32\")])));\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_call\n                                     (Ast.Decl_call (\n                                        (Ast.Relational_expr\n                                           (Ast.Relational_val\n                                              (Ast.Additive_val\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_val\n                                                       (Ast.Ident \"Box\")))))),\n                                        [(Ast.Positional\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.Int 123)))))))\n                                          ]\n                                        )))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"str_box\"; generics = [];\n                params = [];\n                explicit_ret =\n                (Some (Ast.Generic (\"Box\", [(Ast.User \"string\")])));\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_call\n                                      (Ast.Decl_call (\n                                         (Ast.Relational_expr\n                                            (Ast.Relational_val\n                                               (Ast.Additive_val\n                                                  (Ast.Multiplicative_val\n                                                     (Ast.Unary_val\n                                                        (Ast.Ident \"Box\")))))),\n                                         [(Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.String\n                                                               \"generic\")))))))\n                                           ]\n                                         )))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"pair\"; generics = []; params = [];\n                explicit_ret =\n                (Some (Ast.Generic (\"Pair\",\n                         [(Ast.User \"i32\"); (Ast.User \"string\")])));\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_call\n                                      (Ast.Decl_call (\n                                         (Ast.Relational_expr\n                                            (Ast.Relational_val\n                                               (Ast.Additive_val\n                                                  (Ast.Multiplicative_val\n                                                     (Ast.Unary_val\n                                                        (Ast.Ident \"Pair\")))))),\n                                         [(Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.Int 7)))))));\n                                           (Ast.Positional\n                                              (Ast.Relational_expr\n                                                 (Ast.Relational_val\n                                                    (Ast.Additive_val\n                                                       (Ast.Multiplicative_val\n                                                          (Ast.Unary_val\n                                                             (Ast.String\n                                                                \"pair\")))))))\n                                           ]\n                                         )))))))))});\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"int: %d, str: %s\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_call\n                                                    (Ast.Decl_call (\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"int_box\")),\n                                                                    \"get\")))))),\n                                                       []))))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_call\n                                                    (Ast.Decl_call (\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"str_box\")),\n                                                                    \"get\")))))),\n                                                       []))))))))\n                                  ]\n                                ))))))))\n           ],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_call\n                                                (Ast.Decl_call (\n                                                   (Ast.Relational_expr\n                                                      (Ast.Relational_val\n                                                         (Ast.Additive_val\n                                                            (Ast.Multiplicative_val\n                                                               (Ast.Unary_val\n                                                                  (Ast.Ident\n                                                                    \"printf\")))))),\n                                                   [(Ast.Positional\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"pair: %d, %s\\n\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"pair\")),\n                                                                    \"first\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_member (\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"pair\")),\n                                                                    \"second\"\n                                                                    )))))))\n                                                     ]\n                                                   ))))))),\n                                 [])))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_generics.asm\n===== build/emit/test_generics.asm (generated) =====\nextern malloc\nextern printf\nglobal Box\nglobal Box_get\nglobal Pair\nglobal main\nsection .text\nBox_get:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  mov rax, [rax+0]\nBox_get_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nBox:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  push r12\n  mov rax, [rbp-8]\n  pop r12\n  mov [r12+0], rax\n  mov rax, r12\nBox_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nPair:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov [rbp-16], rsi\n  mov rdi, 16\n  call malloc\n  mov r12, rax\n  push r12\n  mov rax, [rbp-8]\n  pop r12\n  mov [r12+0], rax\n  push r12\n  mov rax, [rbp-16]\n  pop r12\n  mov [r12+8], rax\n  mov rax, r12\nPair_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 32\n  sub rsp, 32\n  mov rax, 123\n  push rax\n  pop rax\n  mov rdi, rax\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  push r12\n  mov rax, 123\n  pop r12\n  mov [r12+0], rax\n  mov rax, r12\n  mov [rbp-8], rax\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 103\n  mov byte [r12+1], 101\n  mov byte [r12+2], 110\n  mov byte [r12+3], 101\n  mov byte [r12+4], 114\n  mov byte [r12+5], 105\n  mov byte [r12+6], 99\n  mov byte [r12+7], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  push r12\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 103\n  mov byte [r12+1], 101\n  mov byte [r12+2], 110\n  mov byte [r12+3], 101\n  mov byte [r12+4], 114\n  mov byte [r12+5], 105\n  mov byte [r12+6], 99\n  mov byte [r12+7], 0\n  mov rax, r12\n  pop r12\n  mov [r12+0], rax\n  mov rax, r12\n  mov [rbp-16], rax\n  mov rax, 7\n  push rax\n  push rax\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 112\n  mov byte [r12+1], 97\n  mov byte [r12+2], 105\n  mov byte [r12+3], 114\n  mov byte [r12+4], 0\n  mov rax, r12\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  mov rdi, 16\n  call malloc\n  mov r12, rax\n  push r12\n  mov rax, 7\n  pop r12\n  mov [r12+0], rax\n  push r12\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 112\n  mov byte [r12+1], 97\n  mov byte [r12+2], 105\n  mov byte [r12+3], 114\n  mov byte [r12+4], 0\n  mov rax, r12\n  pop r12\n  mov [r12+8], rax\n  mov rax, r12\n  mov [rbp-24], rax\n  mov rdi, 18\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 105\n  mov byte [r12+1], 110\n  mov byte [r12+2], 116\n  mov byte [r12+3], 58\n  mov byte [r12+4], 32\n  mov byte [r12+5], 37\n  mov byte [r12+6], 100\n  mov byte [r12+7], 44\n  mov byte [r12+8], 32\n  mov byte [r12+9], 115\n  mov byte [r12+10], 116\n  mov byte [r12+11], 114\n  mov byte [r12+12], 58\n  mov byte [r12+13], 32\n  mov byte [r12+14], 37\n  mov byte [r12+15], 115\n  mov byte [r12+16], 10\n  mov byte [r12+17], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  mov rdi, rax\n  call Box_get\n  add rsp, 8\n  push rax\n  mov rax, [rbp-16]\n  mov rdi, rax\n  call Box_get\n  push rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rdi, 14\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 112\n  mov byte [r12+1], 97\n  mov byte [r12+2], 105\n  mov byte [r12+3], 114\n  mov byte [r12+4], 58\n  mov byte [r12+5], 32\n  mov byte [r12+6], 37\n  mov byte [r12+7], 100\n  mov byte [r12+8], 44\n  mov byte [r12+9], 32\n  mov byte [r12+10], 37\n  mov byte [r12+11], 115\n  mov byte [r12+12], 10\n  mov byte [r12+13], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-24]\n  mov rax, [rax+0]\n  add rsp, 8\n  push rax\n  mov rax, [rbp-24]\n  mov rax, [rax+8]\n  push rax\n  pop rax\n  mov rdx, rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "int: 123, str: generic\npair: 7, pair",
    "code": 0
  },
  {
    "file": "tests/test_macros.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"const_num\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Macro_expr\n                  [(Ast.Statement\n                      (Ast.Expression_stmt\n                         (Ast.Relational_expr\n                            (Ast.Relational_val\n                               (Ast.Additive_val\n                                  (Ast.Multiplicative_val\n                                     (Ast.Unary_val (Ast.Int 42))))))))\n                    ])))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_call\n                                                (Ast.Decl_call (\n                                                   (Ast.Relational_expr\n                                                      (Ast.Relational_val\n                                                         (Ast.Additive_val\n                                                            (Ast.Multiplicative_val\n                                                               (Ast.Unary_val\n                                                                  (Ast.Ident\n                                                                    \"printf\")))))),\n                                                   [(Ast.Positional\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"Macro test complete\\n\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Multiplicative_val\n                                                                    (\n                                                                    Ast.Unary_val\n                                                                    (Ast.Int\n                                                                    0)))))))\n                                                     ]\n                                                   ))))))),\n                                 [])))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_macros.asm\n===== build/emit/test_macros.asm (generated) =====\nextern malloc\nextern printf\nglobal const_num\nglobal main\nsection .text\nconst_num:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 0\n  ; macro expressions are not supported yet\n  mov rax, 0\nconst_num_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 0\n  mov rdi, 21\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 77\n  mov byte [r12+1], 97\n  mov byte [r12+2], 99\n  mov byte [r12+3], 114\n  mov byte [r12+4], 111\n  mov byte [r12+5], 32\n  mov byte [r12+6], 116\n  mov byte [r12+7], 101\n  mov byte [r12+8], 115\n  mov byte [r12+9], 116\n  mov byte [r12+10], 32\n  mov byte [r12+11], 99\n  mov byte [r12+12], 111\n  mov byte [r12+13], 109\n  mov byte [r12+14], 112\n  mov byte [r12+15], 108\n  mov byte [r12+16], 101\n  mov byte [r12+17], 116\n  mov byte [r12+18], 101\n  mov byte [r12+19], 10\n  mov byte [r12+20], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 0\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "Macro test complete",
    "code": 0
  },
  {
    "file": "tests/test_match.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"x\"; generics = []; params = [];\n               explicit_ret = None;\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_val (Ast.Int 3))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"result\"; generics = [];\n                params = []; explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Match_expr\n                          ((Ast.Relational_expr\n                              (Ast.Relational_val\n                                 (Ast.Additive_val\n                                    (Ast.Multiplicative_val\n                                       (Ast.Unary_val (Ast.Ident \"x\")))))),\n                           [((Ast.Single\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val (Ast.Int 1))))))),\n                             None,\n                             ([],\n                              (Some (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_call\n                                                   (Ast.Decl_call (\n                                                      (Ast.Relational_expr\n                                                         (Ast.Relational_val\n                                                            (Ast.Additive_val\n                                                               (Ast.Multiplicative_val\n                                                                  (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"printf\")))))),\n                                                      [(Ast.Positional\n                                                          (Ast.Relational_expr\n                                                             (Ast.Relational_val\n                                                                (Ast.Additive_val\n                                                                   (Ast.Multiplicative_val\n                                                                    (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"one\\n\")))))))\n                                                        ]\n                                                      ))))))))));\n                             ((Ast.Single\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_val (Ast.Int 2))))))),\n                              None,\n                              ([],\n                               (Some (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_call\n                                                    (Ast.Decl_call (\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"printf\")))))),\n                                                       [(Ast.Positional\n                                                           (Ast.Relational_expr\n                                                              (Ast.Relational_val\n                                                                 (Ast.Additive_val\n                                                                    (\n                                                                    Ast.Multiplicative_val\n                                                                    (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"two\\n\")))))))\n                                                         ]\n                                                       ))))))))));\n                             ((Ast.Single\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_val (Ast.Ident \"_\"))))))),\n                              None,\n                              ([],\n                               (Some (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_call\n                                                    (Ast.Decl_call (\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_call\n                                                                    (Ast.Decl_call (\n                                                                    (Ast.Relational_expr\n                                                                    (Ast.Relational_val\n                                                                    (Ast.Additive_val\n                                                                    (Ast.Multiplicative_val\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Ident\n                                                                    \"printf\")))))),\n                                                                    [(Ast.Positional\n                                                                    (Ast.Relational_expr\n                                                                    (Ast.Relational_val\n                                                                    (Ast.Additive_val\n                                                                    (Ast.Multiplicative_val\n                                                                    (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"other\\n\")))))))\n                                                                    ]))))))),\n                                                       []))))))))))\n                             ]))))})\n           ],\n         None)}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_match.asm\n===== build/emit/test_match.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov rax, 3\n  mov [rbp-8], rax\n  mov rax, [rbp-8]\n  mov r13, rax\n  cmp r13, 1\n  jne __match_next_13\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 111\n  mov byte [r12+1], 110\n  mov byte [r12+2], 101\n  mov byte [r12+3], 10\n  mov byte [r12+4], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  jmp __match_end_12\n__match_next_13:\n  cmp r13, 2\n  jne __match_next_14\n  mov rdi, 5\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 116\n  mov byte [r12+1], 119\n  mov byte [r12+2], 111\n  mov byte [r12+3], 10\n  mov byte [r12+4], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  jmp __match_end_12\n__match_next_14:\n  mov rdi, 7\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 111\n  mov byte [r12+1], 116\n  mov byte [r12+2], 104\n  mov byte [r12+3], 101\n  mov byte [r12+4], 114\n  mov byte [r12+5], 10\n  mov byte [r12+6], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  jmp __match_end_12\n__match_next_15:\n  mov rax, 60\n  mov rdi, 1\n  syscall\n__match_end_12:\n  mov [rbp-16], rax\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "other",
    "code": 0
  },
  {
    "file": "tests/test_power.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"base\"; generics = []; params = [];\n               explicit_ret = None;\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_val (Ast.Int 2))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"exp\"; generics = []; params = [];\n                explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_val (Ast.Int 10))))))))});\n           (Ast.Decl_stmt\n              Ast.Decl {tags = []; name = \"result\"; generics = [];\n                params = []; explicit_ret = None;\n                body =\n                ([],\n                 (Some (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Pow (\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_val (Ast.Ident \"base\"))),\n                                   (Ast.Unary_val (Ast.Ident \"exp\")))))))))});\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String\n                                                      \"2 ^ 10 = %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.Ident \"result\")))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String \"3 ^ 3 = %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Pow (\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_val\n                                                       (Ast.Int 3))),\n                                                 (Ast.Unary_val (Ast.Int 3))\n                                                 ))))))\n                                  ]\n                                ))))))));\n           (Ast.Expression_stmt\n              (Ast.Relational_expr\n                 (Ast.Relational_val\n                    (Ast.Additive_val\n                       (Ast.Multiplicative_val\n                          (Ast.Unary_call\n                             (Ast.Decl_call (\n                                (Ast.Relational_expr\n                                   (Ast.Relational_val\n                                      (Ast.Additive_val\n                                         (Ast.Multiplicative_val\n                                            (Ast.Unary_val\n                                               (Ast.Ident \"printf\")))))),\n                                [(Ast.Positional\n                                    (Ast.Relational_expr\n                                       (Ast.Relational_val\n                                          (Ast.Additive_val\n                                             (Ast.Multiplicative_val\n                                                (Ast.Unary_val\n                                                   (Ast.String \"5 ^ 0 = %d\\n\")))))));\n                                  (Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Pow (\n                                                 (Ast.Multiplicative_val\n                                                    (Ast.Unary_val\n                                                       (Ast.Int 5))),\n                                                 (Ast.Unary_val (Ast.Int 0))\n                                                 ))))))\n                                  ]\n                                ))))))))\n           ],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_call\n                                                (Ast.Decl_call (\n                                                   (Ast.Relational_expr\n                                                      (Ast.Relational_val\n                                                         (Ast.Additive_val\n                                                            (Ast.Multiplicative_val\n                                                               (Ast.Unary_val\n                                                                  (Ast.Ident\n                                                                    \"printf\")))))),\n                                                   [(Ast.Positional\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.String\n                                                                    \"10 ^ 1 = %d\\n\")))))));\n                                                     (Ast.Positional\n                                                        (Ast.Relational_expr\n                                                           (Ast.Relational_val\n                                                              (Ast.Additive_val\n                                                                 (Ast.Pow (\n                                                                    (\n                                                                    Ast.Multiplicative_val\n                                                                    (Ast.Unary_val\n                                                                    (Ast.Int\n                                                                    10))),\n                                                                    (\n                                                                    Ast.Unary_val\n                                                                    (Ast.Int\n                                                                    1))))))))\n                                                     ]\n                                                   ))))))),\n                                 [])))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_power.asm\n===== build/emit/test_power.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 32\n  sub rsp, 32\n  mov rax, 2\n  mov [rbp-8], rax\n  mov rax, 10\n  mov [rbp-16], rax\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-16]\n  mov rcx, rax\n  pop rbx\n  mov rax, 1\n  test rcx, rcx\n  jle __pow_end_20\n__pow_loop_21:\n  imul rax, rbx\n  dec rcx\n  jnz __pow_loop_21\n__pow_end_20:\n  mov [rbp-24], rax\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 50\n  mov byte [r12+1], 32\n  mov byte [r12+2], 94\n  mov byte [r12+3], 32\n  mov byte [r12+4], 49\n  mov byte [r12+5], 48\n  mov byte [r12+6], 32\n  mov byte [r12+7], 61\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-24]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rdi, 12\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 51\n  mov byte [r12+1], 32\n  mov byte [r12+2], 94\n  mov byte [r12+3], 32\n  mov byte [r12+4], 51\n  mov byte [r12+5], 32\n  mov byte [r12+6], 61\n  mov byte [r12+7], 32\n  mov byte [r12+8], 37\n  mov byte [r12+9], 100\n  mov byte [r12+10], 10\n  mov byte [r12+11], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 3\n  push rax\n  mov rax, 3\n  mov rcx, rax\n  pop rbx\n  mov rax, 1\n  test rcx, rcx\n  jle __pow_end_22\n__pow_loop_23:\n  imul rax, rbx\n  dec rcx\n  jnz __pow_loop_23\n__pow_end_22:\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rdi, 12\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 53\n  mov byte [r12+1], 32\n  mov byte [r12+2], 94\n  mov byte [r12+3], 32\n  mov byte [r12+4], 48\n  mov byte [r12+5], 32\n  mov byte [r12+6], 61\n  mov byte [r12+7], 32\n  mov byte [r12+8], 37\n  mov byte [r12+9], 100\n  mov byte [r12+10], 10\n  mov byte [r12+11], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 5\n  push rax\n  mov rax, 0\n  mov rcx, rax\n  pop rbx\n  mov rax, 1\n  test rcx, rcx\n  jle __pow_end_24\n__pow_loop_25:\n  imul rax, rbx\n  dec rcx\n  jnz __pow_loop_25\n__pow_end_24:\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rdi, 13\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 49\n  mov byte [r12+1], 48\n  mov byte [r12+2], 32\n  mov byte [r12+3], 94\n  mov byte [r12+4], 32\n  mov byte [r12+5], 49\n  mov byte [r12+6], 32\n  mov byte [r12+7], 61\n  mov byte [r12+8], 32\n  mov byte [r12+9], 37\n  mov byte [r12+10], 100\n  mov byte [r12+11], 10\n  mov byte [r12+12], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, 10\n  push rax\n  mov rax, 1\n  mov rcx, rax\n  pop rbx\n  mov rax, 1\n  test rcx, rcx\n  jle __pow_end_26\n__pow_loop_27:\n  imul rax, rbx\n  dec rcx\n  jnz __pow_loop_27\n__pow_end_26:\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "2 ^ 10 = 1024\n3 ^ 3 = 27\n5 ^ 0 = 1\n10 ^ 1 = 10",
    "code": 0
  },
  {
    "file": "tests/test_simple_for_loop.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([(Ast.Expression_stmt\n             (Ast.Relational_expr\n                (Ast.Relational_val\n                   (Ast.Additive_val\n                      (Ast.Multiplicative_val\n                         (Ast.Unary_call\n                            (Ast.Decl_call (\n                               (Ast.Relational_expr\n                                  (Ast.Relational_val\n                                     (Ast.Additive_val\n                                        (Ast.Multiplicative_val\n                                           (Ast.Unary_val\n                                              (Ast.Ident \"printf\")))))),\n                               [(Ast.Positional\n                                   (Ast.Relational_expr\n                                      (Ast.Relational_val\n                                         (Ast.Additive_val\n                                            (Ast.Multiplicative_val\n                                               (Ast.Unary_val\n                                                  (Ast.String\n                                                     \"Testing simple for loop\\n\")))))))\n                                 ]\n                               ))))))));\n           (Ast.For_stmt\n              (Ast.For_iter\n                 { Ast.var = \"i\";\n                   iterable =\n                   (Ast.Relational_expr\n                      (Ast.Relational_val\n                         (Ast.Additive_val\n                            (Ast.Multiplicative_val\n                               (Ast.Unary_val (Ast.Int 5))))));\n                   body =\n                   [(Ast.Statement\n                       (Ast.Expression_stmt\n                          (Ast.Relational_expr\n                             (Ast.Relational_val\n                                (Ast.Additive_val\n                                   (Ast.Multiplicative_val\n                                      (Ast.Unary_call\n                                         (Ast.Decl_call (\n                                            (Ast.Relational_expr\n                                               (Ast.Relational_val\n                                                  (Ast.Additive_val\n                                                     (Ast.Multiplicative_val\n                                                        (Ast.Unary_val\n                                                           (Ast.Ident\n                                                              \"printf\")))))),\n                                            [(Ast.Positional\n                                                (Ast.Relational_expr\n                                                   (Ast.Relational_val\n                                                      (Ast.Additive_val\n                                                         (Ast.Multiplicative_val\n                                                            (Ast.Unary_val\n                                                               (Ast.String\n                                                                  \"i = %d\\n\")))))));\n                                              (Ast.Positional\n                                                 (Ast.Relational_expr\n                                                    (Ast.Relational_val\n                                                       (Ast.Additive_val\n                                                          (Ast.Multiplicative_val\n                                                             (Ast.Unary_val\n                                                                (Ast.Ident\n                                                                   \"i\")))))))\n                                              ]\n                                            )))))))))\n                     ]\n                   }))\n           ],\n         None)}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_simple_for_loop.asm\n===== build/emit/test_simple_for_loop.asm (generated) =====\nextern malloc\nextern printf\nglobal main\nsection .text\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov rdi, 25\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 84\n  mov byte [r12+1], 101\n  mov byte [r12+2], 115\n  mov byte [r12+3], 116\n  mov byte [r12+4], 105\n  mov byte [r12+5], 110\n  mov byte [r12+6], 103\n  mov byte [r12+7], 32\n  mov byte [r12+8], 115\n  mov byte [r12+9], 105\n  mov byte [r12+10], 109\n  mov byte [r12+11], 112\n  mov byte [r12+12], 108\n  mov byte [r12+13], 101\n  mov byte [r12+14], 32\n  mov byte [r12+15], 102\n  mov byte [r12+16], 111\n  mov byte [r12+17], 114\n  mov byte [r12+18], 32\n  mov byte [r12+19], 108\n  mov byte [r12+20], 111\n  mov byte [r12+21], 111\n  mov byte [r12+22], 112\n  mov byte [r12+23], 10\n  mov byte [r12+24], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 5\n  mov [rbp - 8], rax\n  mov qword [rbp - 16], 0\n__for_start_36:\n  mov rcx, [rbp - 8]\n  cmp rcx, 0\n  jle __for_end_37\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 105\n  mov byte [r12+1], 32\n  mov byte [r12+2], 61\n  mov byte [r12+3], 32\n  mov byte [r12+4], 37\n  mov byte [r12+5], 100\n  mov byte [r12+6], 10\n  mov byte [r12+7], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-16]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  dec qword [rbp - 8]\n  inc qword [rbp - 16]\n  jmp __for_start_36\n__for_end_37:\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "Testing simple for loop\ni = 0\ni = 1\ni = 2\ni = 3\ni = 4",
    "code": 0
  },
  {
    "file": "tests/test_while.nova",
    "parse": "\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdio\";\n        exports =\n        [(Ast.Export_ident \"printf\"); (Ast.Export_ident \"puts\");\n          (Ast.Export_ident \"putchar\"); (Ast.Export_ident \"getchar\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"printf\"; calling_conf = \"c\";\n                 link_name = \"printf\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"puts\"; calling_conf = \"c\";\n                  link_name = \"puts\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"putchar\"; calling_conf = \"c\";\n                  link_name = \"putchar\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"getchar\"; calling_conf = \"c\";\n                  link_name = \"getchar\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"stdlib\";\n        exports =\n        [(Ast.Export_ident \"malloc\"); (Ast.Export_ident \"calloc\");\n          (Ast.Export_ident \"realloc\"); (Ast.Export_ident \"free\");\n          (Ast.Export_ident \"exit\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"malloc\"; calling_conf = \"c\";\n                 link_name = \"malloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"calloc\"; calling_conf = \"c\";\n                  link_name = \"calloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"realloc\"; calling_conf = \"c\";\n                  link_name = \"realloc\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"free\"; calling_conf = \"c\";\n                  link_name = \"free\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"exit\"; calling_conf = \"c\";\n                  link_name = \"exit\"}))\n          ]}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Module_decl {name = \"string\";\n        exports =\n        [(Ast.Export_ident \"strlen\"); (Ast.Export_ident \"strcmp\");\n          (Ast.Export_ident \"strcpy\"); (Ast.Export_ident \"strncpy\");\n          (Ast.Export_ident \"memcpy\"); (Ast.Export_ident \"memset\")];\n        body =\n        [(Ast.Statement\n            (Ast.Decl_stmt\n               Ast.Import_decl {name = \"strlen\"; calling_conf = \"c\";\n                 link_name = \"strlen\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcmp\"; calling_conf = \"c\";\n                  link_name = \"strcmp\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strcpy\"; calling_conf = \"c\";\n                  link_name = \"strcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"strncpy\"; calling_conf = \"c\";\n                  link_name = \"strncpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memcpy\"; calling_conf = \"c\";\n                  link_name = \"memcpy\"}));\n          (Ast.Statement\n             (Ast.Decl_stmt\n                Ast.Import_decl {name = \"memset\"; calling_conf = \"c\";\n                  link_name = \"memset\"}))\n          ]}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"println\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"print\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"println\"; calling_conf = \"c\";\n        link_name = \"puts\"}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Import_decl {name = \"print\"; calling_conf = \"c\";\n        link_name = \"printf\"}))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"square\"))))\n(Ast.Statement (Ast.Decl_stmt (Ast.Export_stmt (Ast.Export_ident \"double\"))))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"square\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Mul (\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\"))),\n                           (Ast.Unary_val (Ast.Ident \"x\")))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"double\"; generics = [];\n        params = [(Ast.Typed (\"x\", (Ast.User \"i32\")))];\n        explicit_ret = (Some (Ast.User \"i32\"));\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Add (\n                        (Ast.Additive_val\n                           (Ast.Multiplicative_val\n                              (Ast.Unary_val (Ast.Ident \"x\")))),\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_val (Ast.Ident \"x\")))\n                        ))))))}))\n(Ast.Statement\n   (Ast.Open_stmt\n      { Ast.mods = [\"std\"; \"c\"];\n        elements = [{ Ast.path = [\"stdio\"; \"printf\"]; alias = None }] }))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"countdown\"; generics = [];\n        params = [(Ast.Untyped \"n\")]; explicit_ret = None;\n        body =\n        ([(Ast.Decl_stmt\n             Ast.Decl {tags = []; name = \"m\"; generics = []; params = [];\n               explicit_ret = None;\n               body =\n               ([],\n                (Some (Ast.Relational_expr\n                         (Ast.Relational_val\n                            (Ast.Additive_val\n                               (Ast.Multiplicative_val\n                                  (Ast.Unary_val (Ast.Ident \"n\"))))))))});\n           (Ast.While_stmt\n              { Ast.cond =\n                (Ast.Relational_expr\n                   (Ast.Gt (\n                      (Ast.Additive_val\n                         (Ast.Multiplicative_val\n                            (Ast.Unary_val (Ast.Ident \"m\")))),\n                      (Ast.Additive_val\n                         (Ast.Multiplicative_val (Ast.Unary_val (Ast.Int 0))))\n                      )));\n                body =\n                [(Ast.Statement\n                    (Ast.Expression_stmt\n                       (Ast.Relational_expr\n                          (Ast.Relational_val\n                             (Ast.Additive_val\n                                (Ast.Multiplicative_val\n                                   (Ast.Unary_call\n                                      (Ast.Decl_call (\n                                         (Ast.Relational_expr\n                                            (Ast.Relational_val\n                                               (Ast.Additive_val\n                                                  (Ast.Multiplicative_val\n                                                     (Ast.Unary_val\n                                                        (Ast.Ident \"printf\")))))),\n                                         [(Ast.Positional\n                                             (Ast.Relational_expr\n                                                (Ast.Relational_val\n                                                   (Ast.Additive_val\n                                                      (Ast.Multiplicative_val\n                                                         (Ast.Unary_val\n                                                            (Ast.String\n                                                               \"n = %d\\n\")))))));\n                                           (Ast.Positional\n                                              (Ast.Relational_expr\n                                                 (Ast.Relational_val\n                                                    (Ast.Additive_val\n                                                       (Ast.Multiplicative_val\n                                                          (Ast.Unary_val\n                                                             (Ast.Ident \"m\")))))))\n                                           ]\n                                         )))))))));\n                  (Ast.Statement\n                     (Ast.Expression_stmt\n                        (Ast.Assignment_expr\n                           (Ast.Sub_assign (\"m\",\n                              (Ast.Additive_val\n                                 (Ast.Multiplicative_val\n                                    (Ast.Unary_val (Ast.Int 1))))\n                              )))))\n                  ]\n                })\n           ],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_val\n                                                (Ast.Ident \"printf\")))))),\n                                 [(Ast.Positional\n                                     (Ast.Relational_expr\n                                        (Ast.Relational_val\n                                           (Ast.Additive_val\n                                              (Ast.Multiplicative_val\n                                                 (Ast.Unary_val\n                                                    (Ast.String \"done!\\n\")))))))\n                                   ]\n                                 )))))))))}))\n(Ast.Statement\n   (Ast.Decl_stmt\n      Ast.Decl {tags = []; name = \"main\"; generics = []; params = [];\n        explicit_ret = None;\n        body =\n        ([],\n         (Some (Ast.Relational_expr\n                  (Ast.Relational_val\n                     (Ast.Additive_val\n                        (Ast.Multiplicative_val\n                           (Ast.Unary_call\n                              (Ast.Decl_call (\n                                 (Ast.Relational_expr\n                                    (Ast.Relational_val\n                                       (Ast.Additive_val\n                                          (Ast.Multiplicative_val\n                                             (Ast.Unary_call\n                                                (Ast.Decl_call (\n                                                   (Ast.Relational_expr\n                                                      (Ast.Relational_val\n                                                         (Ast.Additive_val\n                                                            (Ast.Multiplicative_val\n                                                               (Ast.Unary_val\n                                                                  (Ast.Ident\n                                                                    \"countdown\")))))),\n                                                   [(Ast.Positional\n                                                       (Ast.Relational_expr\n                                                          (Ast.Relational_val\n                                                             (Ast.Additive_val\n                                                                (Ast.Multiplicative_val\n                                                                   (Ast.Unary_val\n                                                                    (Ast.Int\n                                                                    3)))))))\n                                                     ]\n                                                   ))))))),\n                                 [])))))))))}))",
    "codegen": "Wrote build/emit/root.asm\n===== build/emit/root.asm (generated) =====\n\n\n  Wrote build/emit/c.asm\n===== build/emit/c.asm (generated) =====\nglobal stdio_getchar\nglobal stdio_printf\nglobal stdio_putchar\nglobal stdio_puts\nglobal stdlib_calloc\nglobal stdlib_exit\nglobal stdlib_free\nglobal stdlib_malloc\nglobal stdlib_realloc\nglobal string_memcpy\nglobal string_memset\nglobal string_strcmp\nglobal string_strcpy\nglobal string_strlen\nglobal string_strncpy\nsection .text\nstdio_printf:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_puts:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_putchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdio_getchar:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_malloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_calloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_realloc:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_free:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstdlib_exit:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strlen:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcmp:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_strncpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memcpy:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nstring_memset:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/io.asm\n===== build/emit/io.asm (generated) =====\nglobal print\nglobal println\nsection .text\nprintln:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\nprint:\n  push rbp\n  mov rbp, rsp\n  ; stub: abort (unimplemented)\n  mov rax, 60\n  mov rdi, 1\n  syscall\n  ud2\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/math.asm\n===== build/emit/math.asm (generated) =====\nglobal double\nglobal square\nsection .text\nsquare:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  imul rax, rbx\nsquare_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\ndouble:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  push rax\n  mov rax, [rbp-8]\n  pop rbx\n  add rax, rbx\ndouble_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\n\n\n  Wrote build/emit/test_while.asm\n===== build/emit/test_while.asm (generated) =====\nextern malloc\nextern printf\nglobal countdown\nglobal main\nsection .text\ncountdown:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 16\n  sub rsp, 16\n  mov [rbp-8], rdi\n  mov rax, [rbp-8]\n  mov [rbp-8], rax\n__while_start_40:\n  mov rax, [rbp-8]\n  push rax\n  mov rax, 0\n  pop rbx\n  cmp rbx, rax\n  setg al\n  movzx rax, al\n  cmp rax, 0\n  je __while_end_41\n  mov rdi, 8\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 110\n  mov byte [r12+1], 32\n  mov byte [r12+2], 61\n  mov byte [r12+3], 32\n  mov byte [r12+4], 37\n  mov byte [r12+5], 100\n  mov byte [r12+6], 10\n  mov byte [r12+7], 0\n  mov rax, r12\n  push rax\n  push rax\n  mov rax, [rbp-8]\n  add rsp, 8\n  push rax\n  pop rax\n  mov rsi, rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\n  mov rax, 1\n  mov rbx, [rbp - 8]\n  sub rbx, rax\n  mov [rbp - 8], rbx\n  mov rax, rbx\n  jmp __while_start_40\n__while_end_41:\n  mov rdi, 7\n  call malloc\n  mov r12, rax\n  mov byte [r12+0], 100\n  mov byte [r12+1], 111\n  mov byte [r12+2], 110\n  mov byte [r12+3], 101\n  mov byte [r12+4], 33\n  mov byte [r12+5], 10\n  mov byte [r12+6], 0\n  mov rax, r12\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call printf\ncountdown_end:\n  mov rsp, rbp\n  pop rbp\n  ret\n\nmain:\n  push rbp\n  mov rbp, rsp\n  ; stack alloc 0\n  mov rax, 3\n  push rax\n  pop rax\n  mov rdi, rax\n  xor rax, rax\n  call countdown\n  xor rax, rax\nmain_end:\n  mov rsp, rbp\n  pop rbp\n  ret",
    "run": "n = 3\nn = 2\nn = 1\ndone!",
    "code": 0
  }
]
